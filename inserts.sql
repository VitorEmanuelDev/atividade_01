delete from cartoes;
delete from veiculos;
delete from funcionarios;
delete from empresas;
delete from passageiros;
delete from linhas_pontos ;
delete from pontos;
delete from linhas ;
delete from tipo_funcionario;
delete from viagens;
delete from linhas_empresas ;

--INSERE DADOS DE PASSAGEIROS
INSERT INTO PASSAGEIROS (ID, NOME) VALUES(1, 'CACILDIS TESTANCIA1');
INSERT INTO PASSAGEIROS (ID, NOME) VALUES(2, 'CACILDIS TESTANCIA2');
INSERT INTO PASSAGEIROS (ID, NOME) VALUES(3, 'CACILDIS TESTANCIA3');
INSERT INTO PASSAGEIROS (ID, NOME) VALUES(4, 'CACILDIS TESTANCIA4');
INSERT INTO PASSAGEIROS (ID, NOME) VALUES(5, 'CACILDIS TESTANCIA5');
INSERT INTO PASSAGEIROS (ID, NOME) VALUES(6, 'CACILDIS TESTANCIA6');

--INSERE DADOS DE TIPO FUNCIONARIO

INSERT INTO TIPO_FUNCIONARIO(ID, DESCRICAO) 
VALUES(1, 'MOTORISTA');
INSERT INTO TIPO_FUNCIONARIO(ID, DESCRICAO) 
VALUES(2, 'COBRADOR');
INSERT INTO TIPO_FUNCIONARIO(ID, DESCRICAO) 
VALUES(3, 'CONTROLADOR');

--INSERE DADOS DE EMPRESAS

INSERT INTO EMPRESAS(CNPJ, RAZAO_SOCIAL)VALUES(01945647438893, 'CAIXA FOSFORO');
INSERT INTO EMPRESAS(CNPJ, RAZAO_SOCIAL)VALUES(01943456778893, 'SAUNA MOVEL');
INSERT INTO EMPRESAS(CNPJ, RAZAO_SOCIAL)VALUES(01945647678893, 'NARNIA BUSIVIS');
INSERT INTO EMPRESAS(CNPJ, RAZAO_SOCIAL)VALUES(01945633438893, 'EXPRESSO DO AMANHA');

--insere dados de cartoes

INSERT INTO CARTOES (ID, SALDO, PASSAGEIRO_ID, TIPO) VALUES(1, 50, 1, 1);
INSERT INTO CARTOES (ID, SALDO, PASSAGEIRO_ID, TIPO) VALUES(2, 55, 2, 2);
INSERT INTO CARTOES (ID, SALDO, PASSAGEIRO_ID, TIPO) VALUES(3, 65, 3, 3);
INSERT INTO CARTOES (ID, SALDO, PASSAGEIRO_ID, TIPO) VALUES(4, 75, 4, 1);
INSERT INTO CARTOES (ID, SALDO, PASSAGEIRO_ID, TIPO) VALUES(5, 80, 5, 1);
INSERT INTO CARTOES (ID, SALDO, PASSAGEIRO_ID, TIPO) VALUES(6, 90, 6, 1);

--INSERE DADOS DE VIAGENS
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(1, 5, 'QWERT23','2022-02-28');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(2, 5, 'QWERT24','2022-03-01');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(3, 5, 'QWERT25','2022-03-02');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(4, 5, 'QWERT26','2022-02-28');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(5, 5, 'QWERT23','2022-03-01');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(6, 5, 'QWERT24','2022-03-02');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM ,  VEICULO_PLACA, CRIADO_EM)
VALUES(7, 5, 'QWERT25','2022-02-28');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(8, 5, 'QWERT26','2022-03-01');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(9, 5, 'QWERT23','2022-03-02');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(10, 5, 'QWERT24','2022-02-28');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(11, 5, 'QWERT25','2022-03-01');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM ,  VEICULO_PLACA, CRIADO_EM)
VALUES(12, 5, 'QWERT26','2022-03-02');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(13, 5, 'QWERT23','2022-02-28');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(14, 5, 'QWERT24','2022-03-01');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(15, 5, 'QWERT25','2022-03-02');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(16, 5, 'QWERT26','2022-02-28');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(17, 5, 'QWERT24','2022-03-01');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(18, 5, 'QWERT25','2022-03-02');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM ,  VEICULO_PLACA, CRIADO_EM)
VALUES(19, 5, 'QWERT26','2022-02-28');
INSERT INTO VIAGENS (ID, VALOR_PASSAGEM , VEICULO_PLACA, CRIADO_EM)
VALUES(20, 5, 'QWERT23','2022-03-02');

--INSERE DADOS DE PONTOS
INSERT INTO PONTOS (ID, LOCALIZACAO) VALUES(1, 'SAÚDE');
INSERT INTO PONTOS (ID, LOCALIZACAO) VALUES(2, 'BARBALHO');
INSERT INTO PONTOS (ID, LOCALIZACAO) VALUES(3, 'NAZARÉ');
INSERT INTO PONTOS (ID, LOCALIZACAO) VALUES(4, 'PIEDADE');
INSERT INTO PONTOS (ID, LOCALIZACAO) VALUES(5, 'CAMPO GRANDE');



--INSERE DADOS DE LINHAS
INSERT INTO LINHAS (NUMERO, NOME, ID_VIAGEM) VALUES(1, '1223-QW', 1);
INSERT INTO LINHAS (NUMERO, NOME, ID_VIAGEM)VALUES(2, '1223-QW', 2);
INSERT INTO LINHAS (NUMERO, NOME, ID_VIAGEM) VALUES(3, '1223-QW', 3);
INSERT INTO LINHAS (NUMERO, NOME, ID_VIAGEM) VALUES(4, '1223-QW', 4);

--INSERE DADOS DE LINHAS E PONTOS
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(1, 1, 1);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(2, 1, 2);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(3, 1, 3);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(4, 1, 4);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(5, 2, 4);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(6, 2, 3);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(7, 2, 2);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(8, 2, 1);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(9, 3, 3);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(10, 3, 4);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(11, 3, 5);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(12, 3, 2);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(13, 4, 5);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(14, 4, 4);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(15, 4, 3);
INSERT INTO LINHAS_PONTOS (ID, LINHA_NUMERO, PONTOS_ID) VALUES(16, 4, 1);

--INSERE DADOS DE FUNCIONARIOS
INSERT INTO FUNCIONARIOS(CPF, TRABALHA_PARA, NOME, TIPO, VIAGEM_ID)VALUES
(85248751583, 01945647438893, 'BUKOWSKI VANCISLEI DA SILVA', 1, 1);
INSERT INTO FUNCIONARIOS(CPF, TRABALHA_PARA, NOME, TIPO, VIAGEM_ID)VALUES
(85241411583, 01943456778893, 'JOAO CLAUDIO VAN DAMME', 2, 2);
INSERT INTO FUNCIONARIOS(CPF, TRABALHA_PARA, NOME, TIPO, VIAGEM_ID)VALUES
(85296961583, 01945647678893, 'LUCIANO REZENDE CACILDIS', 1, 3);
INSERT INTO FUNCIONARIOS(CPF, TRABALHA_PARA, NOME, TIPO, VIAGEM_ID)VALUES
(85248454513, 01945633438893, 'MIQUE JÉGUI', 2, 4);

--INSERE DADOS DE VEICULOS
INSERT INTO VEICULOS (PLACA, CPF_FUNCIONARIO) VALUES('QWERT23', 85248751583);
INSERT INTO VEICULOS (PLACA, CPF_FUNCIONARIO) VALUES('QWERT24', 85241411583);
INSERT INTO VEICULOS (PLACA, CPF_FUNCIONARIO) VALUES('QWERT25', 85296961583);
INSERT INTO VEICULOS (PLACA, CPF_FUNCIONARIO) VALUES('QWERT26', 85248454513);

--insere dados de passageiros_viagens
INSERT into PASSAGEIROS_VIAGENS (PASSAGEIRO_ID, VIAGEM_ID) VALUES(1,2);
INSERT into PASSAGEIROS_VIAGENS (PASSAGEIRO_ID, VIAGEM_ID) VALUES(3,4);
INSERT into PASSAGEIROS_VIAGENS (PASSAGEIRO_ID, VIAGEM_ID) VALUES(5,8);
INSERT into PASSAGEIROS_VIAGENS (PASSAGEIRO_ID, VIAGEM_ID) VALUES(6,10);
--insere dados de linhas empresas
INSERT INTO LINHAS_EMPRESAS (EMPRESA_CNPJ, NUMERO_LINHA) VALUES(01945647438893, 1);
INSERT INTO LINHAS_EMPRESAS (EMPRESA_CNPJ, NUMERO_LINHA) VALUES(01943456778893, 2);
INSERT INTO LINHAS_EMPRESAS (EMPRESA_CNPJ, NUMERO_LINHA) VALUES(01945647678893, 3);
INSERT INTO LINHAS_EMPRESAS (EMPRESA_CNPJ, NUMERO_LINHA) VALUES(01945633438893, 4);

--CRIA VIEW MATERIALIZADA
drop materialized view if exists viagens_linhas;


CREATE MATERIALIZED VIEW VIAGENS_LINHAS AS
SELECT VIAGENS.ID, VIAGENS.VALOR_PASSAGEM, VIAGENS.CRIADO_EM, PASSAGEIROS_VIAGENS.PASSAGEIRO_ID, LINHAS.NUMERO as linha_numero 
FROM passageiros_viagens 
join linhas on PASSAGEIROS_VIAGENS.VIAGEM_ID = LINHAS.ID_VIAGEM
join viagens on viagens.id = passageiros_viagens.viagem_id;


--QUESTAO 1 Quantos passageiros passaram em uma determinada linha?
SELECT COUNT(DISTINCT (VIAGENS_LINHAS.PASSAGEIRO_ID)) AS QUANTIDADE_PASSAGEIROS,
VIAGENS_LINHAS.LINHA_NUMERO FROM VIAGENS_LINHAS WHERE VIAGENS_LINHAS.LINHA_NUMERO
= 2 GROUP BY VIAGENS_LINHAS.LINHA_NUMERO;
--QUESTAO 2 Quanto uma determinada linha arrecadou em um determinado dia?
SELECT SUM(VIAGENS_LINHAS.VALOR_PASSAGEM) AS ARRECADACAO_REAIS,
VIAGENS_LINHAS.LINHA_NUMERO FROM VIAGENS_LINHAS WHERE VIAGENS_LINHAS.CRIADO_EM =
'2022-02-28' AND VIAGENS_LINHAS.LINHA_NUMERO = 4 GROUP BY
VIAGENS_LINHAS.LINHA_NUMERO;
